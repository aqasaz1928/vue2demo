define("lesson/index2.0",["juicer","pagination","lesson/js/common","store","common/js/antifake","/static/lib/mocoplayer/2.5/mocoplayer.js","common/js/autocomplete"],function(t,e,i,n,a){function o(t){var e=$("#mp-tip-tpl").html(),i=$("#mp-tip"),n={num:t.mp.point,desc:t.mp.desc};e=juicer(e,n),i.html(e).show().offset(),i.addClass("in"),setTimeout(function(){i.addClass("out").one("bsTransitionEnd",function(){i.hide().removeClass("in out")}).emulateTransitionEnd(300)},3e3)}function s(t){var e=$("#qa-tip-tpl").html(),i=$("#qa-tip");e=juicer(e,{data:t}),i.html(e).show(),$(".bottom-box").delegate(".js-change-qa","click",function(){var t=parseInt($(".showqa").attr("data-qanum")),e=$(this).data("sum"),i=Number(e-1),n=Number(t+1);t==i?n=0:n>i&&(n=0),$(".js-"+t).addClass("hideqa").removeClass("showqa"),$(".js-"+n).removeClass("hideqa").addClass("showqa")}),$(".qa-tip").delegate(".js-close","click",function(){$("#qa-tip").hide()})}function r(t){this.key=t.key,this.container=null,this.wrap=null,this.init(t)}var d={},c={},l={},u="",h=$("#webide-right").width()>40;window.ideRightStatus=h;var f=0,p=0,m=0,g=0,v=0,w=0,y=null,b=0,C=0,P=0,x={mediaChange:"mediaChange",pagePrepared:"pagePrepared",leftOk:"leftOk"},_=[],k=function(){var t={};return{get:function(e){return t[e]},set:function(e,i){t[e]=i}}}(),j={init:function(){var t=this;b=GlobalConfig("blur"),$("#video-container").on("click",".vjs-fullscreen-control",function(){clearInterval(window.fullScreenTimer),window.fullScreenTimer=null,window.fullScreenTimer=setInterval(function(){g++},1e3)}),$(document).on("mousemove",function(e){(e.pageX!=C||e.pageY!=P)&&(C=e.pageX,P=e.pageY,t.reset())}).on("keyup",function(){t.reset()}),t.interval()},interval:function(){clearInterval(window.actTimer),window.actTimer=null,window.actTimer=setInterval(function(){f++},1e3)},reset:function(){},setVideo:function(){},start:function(){f=0,p=0,m=0,g=0,v=0,$.post("/passport/user/loginhistory",{uid:OP_CONFIG.userInfo.uid,browser_key:OP_CONFIG.browser_key,from_course:c.course_id+"-"+c.id}),$.ajax({url:"/lesson/ajaxstartlearn",data:{cid:c.course_id,mid:c.id,rate:c.rate},type:"POST",dataType:"json",success:function(t){0==t.result&&(w=t.data)}})},end:function(t){var t=t||!0;clearInterval(window.fullScreenTimer),window.fullScreenTimer=null,g>v&&(v=g),m=0,f>p&&(p=f),w&&$.ajax({url:"/lesson/ajaxendlearn",type:"POST",dataType:"json",async:t,data:{record_id:w,act_time:p,full_time:v},success:function(){}}),w=0,f=0,p=0,g=0,v=0}};j.init();var O={back:function(){},backToCourse:function(){},expand:function(){var t=$(this),e=$(t.data("target")),i=$(".expand-block-mask");t.hasClass("on")?(t.removeClass("on"),e.removeClass("show"),i.remove()):(t.addClass("on"),e.addClass("show"),i=$('<div class="expand-block-mask"/>').appendTo("body"),i.on("click",function(){t.removeClass("on"),e.removeClass("show"),i.remove()}),E.onChaptersExpand())},pannel:function(t){var e=$(this),t=$(this).data("pannel"),i=null;i&&clearTimeout(i),i=setTimeout(function(){if(t){if($("#chapter-menu").hasClass("on")&&$("#chapter-menu").trigger("click"),e.hasClass("on"))return void E.hidePannel(t);$(".js-menu").removeClass("on"),e.addClass("on"),E.showPannel(t)}},30)}},I=function(){if(window.thePlayer){var t=0;if(window.thePlayer.getCurrentTime&&(t=window.thePlayer.getCurrentTime()||0),c){var e=n.get("_vt")||{},i=e[c.id];if($("#next-mask").hasClass("in"))return delete e[c.id],void n.set("_vt",e);i?(i.t=(new Date).getTime(),i.st=t):(i={t:(new Date).getTime(),st:t},e[c.id]=i),n.set("_vt",e)}}};$.extend(r.prototype,{init:function(t){this.wrap=$("#webide-right"),this.container=$("#"+this.key+"-pannel"),this.container.length||(this.container=$("<div />",{"class":"pannel",id:this.key+"-pannel"}).appendTo(this.wrap)),t.pclass&&this.container.addClass(t.pclass),void 0!=typeof t.showclose&&t.showclose===!1&&this.container.find(".pannel-close").remove(),this.bindEvents(),T.add(this.key,this)},hide:function(){var t="hidden"==$("#qa-pannel").css("visibility")&&"hidden"==$("#note-pannel").css("visibility");if($("#ide-pannel").addClass("active"),this.container.removeClass("active"),$(".js-menu[data-pannel="+this.key+"]").removeClass("on"),!window.ideRightStatus){var e=window.ideRightStatus;t||$("#ide-pannel .idemenu .js-ide-mini").click(),window.ideRightStatus=e}this.afterHide()&&this.afterHide()},show:function(){var t="hidden"==$("#qa-pannel").css("visibility")&&"hidden"==$("#note-pannel").css("visibility");if(this.wrap.find(".pannel").removeClass("active"),this.container.addClass("active"),!window.ideRightStatus){var e=window.ideRightStatus;t&&$("#ide-pannel .idemenu .js-ide-mini").click(),window.ideRightStatus=e}this.afterShow&&this.afterShow()},bindEvents:function(){var t=this;this.container.on("click.pannel","[data-action=close]",function(){t.hide()})},on:function(t,e){return this.methods=this.methods||{},this.methods[t]=e,this},trigger:function(t){var e=[].slice.call(arguments,1);this.methods[t]&&this.methods[t].apply(this,e)},register:function(t,e){return this[t]=e,this},param:function(t,e){var i=arguments;return i.length>1?void(this[t]=e):this[t]},getIdeStatus:function(){return""},setIdeStatus:function(){return""}});var T={inst:[],add:function(t,e){this[t]=e,this.inst.push(e)},get:function(t){return t?this[t]:this.inst}};OP_CONFIG.hasIde&&new r({key:"ide"}).register("aftershow",function(){}),new r({key:"qa",pclass:"white",showclose:OP_CONFIG.hasIde?!0:!1}).on("publish",function(t){var e=this.getPostTpl(),i="",n=t.data,a=this.param("curTabPannel"),o=a.siblings().andSelf().filter(function(){return 0==$(this).data("key")}),s=o.find(".mod-post");i=juicer(e,n),s.find(".empty-holder").length&&s.find(".empty-holder").remove(),$(".i-verify-icon").hide(),i=$(i).hide(),s.prepend(i.fadeIn(600)),this.trigger("contentChange")}).register("getPostTpl",function(){return $("#qa-post-tpl").html()}).register("loadPost",function(t,e,i,n){var a=this,i=i||0;a.qaXHR&&(a.qaXHR.abort(),a.qaXHR=null),a.qaXHR=$.getJSON("/lesson/ajaxquestionlist",{mid:c.id,type:t,page:i+1}).success(function(i){var o=e.find(".mod-post"),s="";s=a.rendPost(t,i.data),o.html(s),n&&n(i)})}).register("rendPost",function(t,e){var i=this.getPostTpl(),n="";return e&&e.data.length?$.each(e.data,function(t,e){e.uid=OP_CONFIG.userInfo.uid,n+=juicer(i,e)}):(i=this.getEmptyPostTpl(),n=juicer(i,{key:t})),n}).register("getEmptyPostTpl",function(){return $("#empty-holder-tpl").html()}).register("afterShow",function(){var t=this,e=this.container.find(".js-verify-box");return 1==this.param("inited")?(e.trigger("reset",0),void $(".i-verify-icon").hide()):(e.verifyCode(),$("#qa-form").Form({init:function(){var e=this;this.form.find(".js-verify-box").show().trigger("reset",0),this.form.find("input[name=title], input[name=verify]").on("blur keyup",function(){var t=$(this).val();t&&$(this).parents(".row:first").find(".ipt-tip").removeClass("error").text("")}),"video"==u&&this.form.find(".js-comp-switch").iswitch().show(),this.form.find("input[name=verify]").on("keydown",function(t){return 13==t.keyCode?($(".js-qa-submit").click(),!1):void 0}),require(["ueditor"],function(){var i=UE.getEditor("qa-textarea",{width:"100%",initialFrameWidth:"100%",initialFrameHeight:80,autoFloatEnabled:!1,autoClearinitialContent:!0,initialStyle:"p{line-height:1.5em;font-size:13px;color:#444}"}),n=0;i.addListener("contentchange",function(){var e=(new Date).getTime();e-n>100&&(t.trigger("contentChange"),n=(new Date).getTime())}),e.form.data("editor",i),e.enableBtn()})},beforeSubmit:function(t){var e=this.form.find("input[name=verify]"),i=!1,n=$("#qa-textarea"),a=this.form.data("editor"),o=(n.attr("placeholder"),""),s=this.form.find("input[name=title]"),r=this.form.find(".js-comp-switch");return s.val().trim()?s.val().length<3||s.val().length>80?(i=!0,this.showIptError(s,"标题长度应为3-80个字符"),this.submitBtn.removeClass("waiting"),!1):(a&&(o=a.getContent(function(){var t=$(a.body.innerHTML);return"initContent"!==t.attr("id")}),"<p>问题补充（选填）：请详细描述你的问题，贴出相关代码或截图，并告知你的操作步骤</p>"==o&&(o=""),t.content=o),e.length&&!e.val()?(i=!0,this.showIptError(e,"验证码不能为空"),this.submitBtn.removeClass("waiting"),!1):e.val().length<4?(i=!0,this.showIptError(e,"验证码输入错误"),this.submitBtn.removeClass("waiting"),!1):(r.is(":visible")&&r.data("selected")&&(t.pic_time=N.getPoint()),t.mid=c.id,void this.submitBtn.text("正在提交..."))):(i=!0,this.showIptError(s,"标题不能为空"),this.submitBtn.removeClass("waiting"),!1)},success:function(t){0==t.result?(T.qa.trigger("publish",t),this.reset(),this.msg({msg:"发布问答成功！",state:"success"})):-103002==t.result?(this.msg({msg:"验证码错误！",state:"error"}),e.trigger("reset",0)):this.opt.error.call(this,t)},error:function(t){this.msg({msg:t.msg,state:"error"}),$(".i-verify-icon").hide(),e.trigger("reset",0)},done:function(){this.submitBtn.text(this.submitBtn.data("text"))},reset:function(){this.form.find("input[name=title]").val("");var t=this.form.find("textarea.js-qa-cnt").attr("placeholder");this.form.data("editor").setContent(t),this.form.find(".js-verify-box").trigger("reset",0)}}),this.container.find(".js-tabs").itabs({change:function(e,i,n){var a=$(this).data("key"),o=i.data("key"),s=T[a];s.param("curTabItem",i),s.param("curTabPannel",n),s.loadPost(o,n,0,function(e){i.data("loaded",!0);var a=n.find(".pagination"),s={};e.data.page&&e.data.page.total>e.data.page.pageSize&&(s=e.data.page,a.pagination(s.total,{prev_text:"上一页",next_text:"下一页",items_per_page:s.pageSize,num_display_entries:3,num_edge_entries:2,callback:function(e){t.loadPost(o,n,e,function(){t.trigger("contentChange")})}})),t.trigger("contentChange")}),t.trigger("contentChange")}}),void this.param("inited",!0))}).on("contentChange",function(){i.scrollbar.init(this.container.find(".scroll"),!0)}).register("reset",function(){var t=this.container.find(".js-tabs"),e=t.find(".tab-bars .bar-item"),i=t.find(".mod-post");e.filter(".active").removeClass("active"),e.first().trigger("click"),i.html(""),t.find(".pagination").html(""),this.container.find(".js-verify-box").trigger("reset",0)}).register("afterHide",function(){E.trigger("afterPannelHide")}),new r({key:"note",pclass:"white"}).on("publish",function(t){var e=this.param("curTabPannel"),i=this.getPostTpl(),n={},a="",o=e.find(".mod-post");n=t.data,n=this.formatPostData(n),n.note_content=n.note_content.replace(/\n/g,"<br/>"),a=juicer(i,n),o.find(".empty-holder").length&&o.find(".empty-holder").remove(),$(".i-verify-icon").hide(),a=$(a).hide(),o.prepend(a.fadeIn(600)),this.trigger("contentChange")}).register("getPostTpl",function(){return $("#note-post-tpl").html()}).register("formatPostData",function(t){var e=OP_CONFIG.userInfo.uid;return e==t.note_author_id&&(t.self=!0),t.note_picture_url&&(t.thumbs={small:t.note_picture_url,big:t.note_big_picture_url,time:t.note_time_point}),t}).register("loadPost",function(t,e,i,n){var a=this,i=i||0;a.noteXHR&&(a.noteXHR.abort(),a.noteXHR=null),a.noteXHR=$.getJSON("/lesson/ajaxnotelist",{mid:c.id,type:t,page:i+1}).success(function(i){var o=e.find(".mod-post"),s=a.rendPost(t,i.data);o.html(s),moco.imagePreview.init(".answerImg"),n&&n(i)})}).register("rendPost",function(t,e){{var i=this,n=this.getPostTpl(),a="";OP_CONFIG.userInfo.uid}return e.data.length?$.each(e.data,function(t,e){e=i.formatPostData(e),a+=juicer(n,e)}):(n=this.getEmptyPostTpl(),a=juicer(n,{type:"note",key:t})),a}).register("getEmptyPostTpl",function(){return $("#empty-holder-tpl").html()}).register("afterShow",function(){var t=this;return this.container.find(".js-verify-box").verifyCode(),1==this.param("inited")?void this.container.find(".js-verify-box").trigger("reset",0):($("#note-form").Form({init:function(){this.form.find(".js-verify-box").show().trigger("reset",0),$("#note-textarea").textarea({min:3,tip:function(t){var e=this.ipt.parents(".row:first").find(".ipt-tip");e.text(t.msg),0!=t.code?(this.ipt.data("error",!1),e.removeClass("error")):(this.ipt.data("error",!0),e.addClass("error"))}}),$("#note-textarea").on("focusin",function(){$(this).on("mousewheel",function(t){t.stopPropagation()})}),"video"==u&&this.form.find(".js-comp-switch").iswitch().show(),this.form.find(".js-comp-checkbox").checkbox(!0),this.form.find("input[name=verify]").on("blur keyup",function(){var t=$(this).val();t&&$(this).parents(".row:first").find(".ipt-tip").removeClass("error").text("")}).on("keydown",function(t){return 13==t.keyCode?($(".js-note-submit").click(),!1):void 0})},beforeSubmit:function(t){var e=this.form.find("input[name=verify]"),i=!1,n=$("#note-textarea"),a=this.form.find(".js-comp-switch:visible");return n.trigger("keyup"),0!=n.data("error")?(i=!0,this.submitBtn.removeClass("waiting"),n.focus(),!1):e.length&&!e.val()?(i=!0,this.showIptError(e,"验证码不能为空"),this.submitBtn.removeClass("waiting"),!1):e.val().length<4?(i=!0,this.showIptError(e,"验证码输入错误"),this.submitBtn.removeClass("waiting"),!1):a.length&&a.is(":not(.close)")&&(!N.getState()||"playing"!=N.getState()&&"paused"!=N.getState())?(i=!0,this.submitBtn.removeClass("waiting"),this.msg({msg:"请在视频播放时截图！",state:"error"}),!1):(a.is(":visible")&&a.data("selected")&&(t.pic_time=N.getPoint(),t.video=c.video_dir),t.mid=c.id,void this.submitBtn.text("正在提交..."))},success:function(t){return-103002==t.result?void this.msg({msg:"验证码错误",state:"error"}):0!=t.result?void this.opt.error.call(this,t):(T.note.trigger("publish",t),this.reset(),this.msg({msg:"发布笔记成功！",state:"success"}),void 0)},error:function(){this.msg({msg:"提交笔记失败！",state:"error"})},done:function(){this.submitBtn.text(this.submitBtn.data("text")),this.form.find(".js-verify-box").trigger("reset",0)},reset:function(){$("#note-textarea").data("$textarea").reset()}}),this.container.find(".js-tabs").itabs({change:function(e,i,n){var a=$(this).data("key"),o=i.data("key"),s=T[a];s.param("curTabItem",i),s.param("curTabPannel",n),s.loadPost(o,n,0,function(e){i.data("loaded",!0);var a=n.find(".pagination"),s={};e.data.page.total>e.data.page.pageSize&&(s=e.data.page,a.pagination(s.total,{prev_text:"上一页",next_text:"下一页",items_per_page:s.pageSize,num_display_entries:3,num_edge_entries:2,callback:function(e){t.loadPost(o,n,e,function(){t.trigger("contentChange")})}})),t.trigger("contentChange")}),t.trigger("contentChange")}}),void this.param("inited",!0))}).on("contentChange",function(){i.scrollbar.init(this.container.find(".scroll"),!0)}).register("reset",function(){var t=this.container.find(".js-tabs"),e=t.find(".tab-bars .bar-item"),i=t.find(".mod-post"),n=this.container.find(".js-comp-switch");"video"==u?n.iswitch().show():n.hide(),e.filter(".active").removeClass("active"),e.first().trigger("click"),i.html(""),t.find(".pagination").html(""),this.container.find(".js-verify-box").trigger("reset",0)}).register("afterHide",function(){E.trigger("afterPannelHide")});var S={tpl:function(){return $("#task-tpl").html()},render:function(t){var e=$("#task-placeholder"),i=this.tpl(),n="";n=juicer(i,t),e.html(n),this.makeScrollbar()},start:function(){var t=c;$("#video-container").html(""),this.show(),this.render(t),this.bindEvents(),OP_CONFIG.exp&&setTimeout($.proxy(function(){this.expTip(OP_CONFIG.exp)},this),8e3),0==OP_CONFIG.lastone&&OP_CONFIG.exp&&"undefined"!=typeof _&&0!=_.length&&this.qaTip(_),F.start(),l&&this.rendNext(l),i.eventProxy.emmit(x.leftOk)},show:function(){$(this.pannel).show()},hide:function(){$(this.pannel).hide()},destroy:function(t){this.hide(),F.send2(!1,null,t)},expTip:function(t){o(t)},qaTip:function(t){setTimeout(function(){s(t)},3e3)},makeScrollbar:function(){var t=$(this.pannel).find(".scroll");i.scrollbar.destroy(t),i.scrollbar.init(t,0),clearInterval(this.interval),this.interval=setInterval(function(){i.scrollbar.init(t)},500)},pannel:"#task-pannel",bindEvents:function(){$(document).off("click.task").on("click.task","#J_CodeQa",function(){$(this).find("dd").stop(!0).slideToggle()})},rendNext:function(t){var e=$("#next-media-tpl").html(),i=$("#task-next-holder");i.replaceWith(juicer(e,t))}},N={pannel:"#video-pannel",start:function(){this.show(),this.play(),l&&this.rendNext(l),F.start("video")},show:function(){$(this.pannel).show()},hide:function(){$(this.pannel).hide()},destroy:function(t){this.hide(),this.mask.hide(!0),F.send2(!1,null,t),this.inst&&this.inst.destroy()},pause:function(){window.thePlayer&&window.thePlayer.pause()},playVideo:function(){window.thePlayer&&window.thePlayer.play()},play:function(){a.stop();var t=this,e=0,i=null,r=c.id;i=n.get("_vt"),"number"!=typeof continueTime?i&&i[r]&&(e=i[r].st||0):e=continueTime,j.start(),window.thePlayer&&window.thePlayer.destroy&&window.thePlayer.destroy(),window.thePlayer=mocoplayer($("#video-container"),{url:"http://coding.imooc.com/lesson/m3u8h5?mid="+r+"&cid="+c.course_id,title:c.name,showAd:!0,currentTime:e,uid:OP_CONFIG.userInfo.uid,phone:OP_CONFIG.userInfo.phone,events:{onReady:function(){if("html5"==this.getPlayType()){var t=this,i=2e3;e?i=0:$("#video-container").append('<div id="js-video-copyright" style="width:100%;height:100%;position:absolute;z-index:599;left:0;top:0;							    	background:#000 url(/static/module/common/img/copyright.png) no-repeat center center;background-size:100% auto"></div>'),y=$("#video-container video"),setTimeout(function(){$("#js-video-copyright").remove(),t.play(),a.start()},i)}},onComplete:function(){OP_CONFIG.exp?(o(OP_CONFIG.exp),0==OP_CONFIG.lastone&&"undefined"!=typeof _&&0!=_.length&&setTimeout(function(){s(_)},3e3),F.send2(!0,function(){})):F.send2(!0,function(t){t.experience?(o(t.experience),0==OP_CONFIG.lastone&&"undefined"!=t.push_ask&&0!=t.push_ask.length&&setTimeout(function(){s(t.push_ask)},3e3)):OP_CONFIG.exp&&(o(OP_CONFIG.exp),0==OP_CONFIG.lastone&&"undefined"!=typeof _&&0!=_.length&&setTimeout(function(){s(_)},3e3))}),t.mask.show(),j.end(),"html5"==this.getPlayType()&&a.stop()},onError:function(){}}})},getPoint:function(){var t=0;return window.thePlayer&&window.thePlayer.getCurrentTime&&(t=window.thePlayer.getCurrentTime()||0),Math.floor(t)},getState:function(){return window.thePlayer.getState()},resize:function(){},review:function(){this.mask.hide(),j.start(),"html5"==window.thePlayer.getPlayType()?($("#video-container").append('<div id="js-video-copyright" style="width:100%;height:100%;position:absolute;z-index:599;left:0;top:0;				    	background:#000 url(/static/module/common/img/copyright.png) no-repeat center center;background-size:100% auto"></div>'),setTimeout(function(){$("#js-video-copyright").remove(),a.start(),window.thePlayer.play()},2e3)):window.thePlayer.play()},mask:function(){return{dom:$("#next-mask"),show:function(){this.dom.addClass("in")},hide:function(){this.dom.removeClass("in")}}}(),rendNext:function(t){var e=$("#next-media-tpl").html(),i=$("#next-media-content");i.html(juicer(e,t))}},F=function(){return function(t){if(OP_CONFIG.userInfo){var e=t,i={},n=(new Date).getTime(),a=((new Date).getTime(),null),o="",s=function(t,a,s){var r,d;r=(new Date).getTime(),d=parseInt(r-n)/1e3,i.mid=s||c.id,i.learn_time=d,i.mode=o,"video"==o&&(i.video_point=e.getPoint());var l={url:"/lesson/ajaxmediauser/",data:i,type:"POST",dataType:"json",success:function(t){0==t.result?(n=r,a&&a(t.data),t.data.experience&&(OP_CONFIG.exp=t.data.experience,0==OP_CONFIG.lastone&&"undefined"!=t.data.push_ask&&0!=t.data.push_ask.length&&(_=t.data.push_ask))):"-105002"==t.result&&$.alert("你的账号在另一地点登录，已被强迫下线。",{info:"如果不是本人操作，建议你修改密码。",callback:function(){window.location.href="http://coding.imooc.com"}})}},u=u||!0;u===!1&&(l.async=!1),$.ajax(l)},r=function(){a=window.setInterval(function(){s(!0,function(t){e.inst&&e.inst.emmit("mpRaised",t)})},6e4)},d={send2:function(t,e,i){s(t,e,i)},reset:function(){n=(new Date).getTime(),a&&clearInterval(a),a=null},start:function(t){o=t||"task",this.reset(),r()}};return d.start(),window.onbeforeunload=function(){c&&I(),s(!1),j.end(!1)},d}}(N)}(),G={collect:function(t){var e=$(this);e.hasClass("on")||$.post("/lesson/ajaxcollectnote",{note_id:t},null,"json").success(function(t){0==t.result&&e.addClass("on").find("em").text(function(t,e){return++e})})},praise:function(t){var e=$(this);e.hasClass("waiting")||(e.addClass("on waiting"),$.post("/lesson/ajaxsupportnote",{note_id:t},function(t){0==t.result&&e.data("action","unpraise").find(".ac-icon i").attr("class","sz-thumb praise-anim").end().find("em").text(function(t,e){return++e})},"json").error(function(){alert("出错啦~")}).complete(function(){e.removeClass("waiting")}))},unpraise:function(t){var e=$(this);e.hasClass("waiting")||(e.removeClass("on"),$.post("/lesson/ajaxdelsupportnote",{note_id:t},function(t){0==t.result&&e.data("action","praise").find(".ac-icon i").attr("class","sz-thumb-o").end().find("em").text(function(t,e){return--e})},"json").error(function(){alert("出错啦~")}).complete(function(){e.removeClass("waiting")}))},edit:function(t){var e=$(this).parents(".post-row"),i=$("#cnt-update-save").clone(),n=e.find(".js-post-cnt"),a=n.html()||"",o=null;e.hasClass("editable")||(o=$(".mod-post").find(".editable"),o.removeClass("editable").find(".js-post-cnt").html(function(){return $(this).data("old")}).removeAttr("contenteditable").end().find(".cnt-area-action").remove(),e.addClass("editable"),n.attr("contenteditable",!0).data("old",a),i.insertAfter(n).attr("id","post-update-"+t).find(".post-update-tip").text("").hide().end().find(".js-post-update").data("nid",t).end().show())},del:function(t){var e=$(this).parents(".post-row");e.hasClass("deleted")||$.imodal.confirm({content:'你确定要删除笔记吗？<br/><span class="smaller">笔记删除将无法恢复</span>'}).then(function(i){"yes"===i&&(e.addClass("deleted").animate({opacity:0,padding:0,height:0},800,function(){$(this).remove()}),$.post("/lesson/ajaxdelmynote",{note_id:t}).success(function(){}))})},update:function(t){var e=$(this).parents(".post-row"),i=e.find(".js-post-cnt"),n=i.text().trim()||"",a={},o=e.find(".post-update-tip");return n.length<3||n.length>300?void o.text("内容长度应为3-300个字符").show():(o.text("").hide(),e.removeClass("editable"),i.removeAttr("contenteditable"),$("#post-update-"+t).hide().remove(),a.note_id=t,a.content=n,void $.post("/lesson/ajaxeditmynote",a).success(function(){}))}};$(".js-verify").bind("input propertychange focus",function(){var t=$(this),e=t.val();4==e.length?$.ajax({url:"/user/checkverify",data:{id:"mediaVerifyCode",verify:e},dataType:"json",success:function(e){"0"==e.result?t.siblings(".i-verify-icon").show():t.siblings(".i-verify-icon").hide()}}):t.siblings(".i-verify-icon").hide()});var q={mode:"",init:function(){var t=this;t.prepare(),i.eventProxy.on(x.mediaChange,function(e){t.change(e)}),i.eventProxy.emmitOne("contentReady")},rend:function(){l?l.cid=c.course_id:l={cid:c.course_id,over:1},this.inst.start()},prepare:function(){this.mode=c.type,2==this.mode?this.inst=S:1==this.mode&&(this.inst=N)},change:function(t){t.oid!=t.nid&&this.inst.destroy(t.oid),this.prepare(),this.rend()}},E={init:function(){var t=this,e=$.hash("mid");OP_CONFIG.mid=e,e&&(OP_CONFIG.oldie||(OP_CONFIG.mid=e,this.state={},n.get("webide_guided")||k.set("guide",!0),this.loadMedia(e,function(){u=1==c.type?"video":"task";var e={left:"#webide-left",right:"#webide-right",dragger:"#webide-drag",container:"#webide-layout",stop:function(){$(window).trigger("layoutChange")}};i.idrag.create(e),q.init(),t.renderPannels(),$(window).hashchange(function(){I();var e=$.hash("mid");e&&t.switchMedia(e)})}),i.eventProxy.on(x.mediaChange,function(){t.setMediaName(),t.resetChapters(),1==c.type?u="video":2==c.type&&(u="task"),document.title=i.unescapeHtml(c.chapter_seqid+"-"+c.seqid+" "+c.name)+"_慕课网";var e=null,n=null;$.each(T.get(),function(t,i){i.container.is(".active")?e=i:n=i}),n&&n.param("inited")&&n.reset(),e&&e.param("inited")&&e.reset(),"undefined"!=typeof window.ide&&ide.inst.triggerEvent("miniStateChanged",!+c.open_ide)}).on(x.pagePrepared,function(){t.hidePageLoad(),n.get("webide_guided")||setTimeout(function(){R.init()},0)}).all("contentReady ideReady",function(){ide&&ide.inst.triggerEvent("miniStateChanged",!+c.open_ide)}),this.bindEvents()))},properties:function(){this.pid=OP_CONFIG.marking,this.$layout=$("#webide-layout"),this.$layoutLeft=$("#webide-left"),this.$layoutRight=$("#webide-right"),this.$mediaName=$("#g-media-name"),this.$pageLoad=$("#pageload"),this.$pageBlock=$("#page-block"),this.$pageBlockMsg=$("#page-block-msg")},setState:function(t){$.extend(this.state,t)},isMini:function(){return this.state.mini},hidePageLoad:function(){this.$pageLoad.addClass("out").fadeOut(300)},loadMedia:function(t,e,n){j.end(),$.ajax({url:"/lesson/ajaxmediainfo",data:{mid:t,cid:OP_CONFIG.curCourse.id},type:"get",dataType:"json",success:function(n){if(0==n.result&&n.data){var a=c.id||t;c=n.data.media_info,l=n.data.next_media_info||null,OP_CONFIG.exp=n.data.experience,OP_CONFIG.mid=c.id,OP_CONFIG.lastone=n.data.media_info.lastone,0==OP_CONFIG.lastone&&"undefined"!=n.data.push_ask&&(_=n.data.push_ask),e&&e(),i.eventProxy.emmit(x.mediaChange,{oid:a,nid:t})}else-11==n.result?window.location.href=window.location.protocol+"//"+window.location.host:-102005==n.result?window.location.href=window.location.protocol+"//"+window.location.host+"/error/noexists":-105002==n.result&&$.alert("你的账号在另一地点登录，已被强迫下线。",{info:"如果不是本人操作，建议你修改密码。",callback:function(){window.location.href="http://coding.imooc.com"}})},complete:function(){"function"==typeof n&&n()}})},switchMedia:function(t){$("#chapter-menu.on").trigger("click");var e=this.$pageBlock.show(),i=null;i=setTimeout($.proxy(function(){this.$pageBlockMsg.show()},this),2e3),this.loadMedia(t,null,function(){e.hide(),i&&(clearTimeout(i),i=null)})},createIde:function(){var t=this.pid,e=this;require(["ide"],function(n){n.edit&&n.edit("#ide-pannel",{ajax:{urlPrefix:"/webide/",data:{marking:t}},minified:function(t){e.onIdeMinified(t)},projectId:OP_CONFIG.projectId,projectSSH:OP_CONFIG.projectSSH,projectUrl:OP_CONFIG.projectUrl,httpService:OP_CONFIG.httpService,termService:OP_CONFIG.termService,termAutoOpen:OP_CONFIG.termAutoOpen,pythonSw:OP_CONFIG.pythonSw}).ready(function(){i.eventProxy.emmitOne("ideReady"),i.eventProxy.emmit(x.pagePrepared)})})},renderPannels:function(){var t=T.get("ide");if(t)t.show(),this.createIde();else{var e=$(".js-menu[data-pannel]");e.first().click().data("sleep",!0),e.filter(function(){return"note"==$(this).data("pannel")}).parent().hide(),i.eventProxy.emmit(x.pagePrepared)}},setMediaName:function(){this.$mediaName.html(c.chapter_seqid+"-"+c.seqid+" "+c.name)},loadChapters:function(t,e){var n=$("#chapter-tpl").html(),a="";a=juicer(n,{data:t}),e.find(".comp-loading").hide().end().prepend(a);var o=$("#chapter-scrollbar");i.scrollbar.init(o,function(){var t=o.find(".cur"),e=t.parent(),n=0,a=o.height(),n=e.position().top;n>a&&(o.scrollTop(n-e.height()),i.scrollbar.update(o))})},resetChapters:function(){$(".js-chapters").data("loaded",!1).data("refresh",!0)},onChaptersExpand:function(){var t=this,e=$(".js-chapters");if(!e.hasClass("loading")&&!e.data("loaded")){if(e.addClass("loading"),e.data("refresh")){var i=e.find(".comp-loading").clone();e.html(i)}$.get("/lesson/ajaxchapterlist",{v:(new Date).getTime(),mid:c.id},null,"json").success(function(i){e.data("loaded",!0),t.loadChapters(i.data,e)}).complete(function(){e.removeClass("loading")})}},onIdeMinified:function(t){var e=this.$layoutLeft,i=this.$layoutRight,n="",a="";t?(n=e.attr("style"),a=i.attr("style"),e.data("style",n),i.data("style",a),i.css({width:"40",right:0,left:"auto"}),e.css({width:"auto",right:40})):(n=e.data("style"),a=i.data("style"),n?e.attr("style",n):e.removeAttr("style"),a?i.attr("style",a):i.removeAttr("style")),this.$layout.toggleClass("webide-mini"),this.setState({mini:t})},on:function(t,e){this.$layout.on(t,$.proxy(e,this))},trigger:function(t,e){this.$layout.trigger(t,this,e)},showPannel:function(t){this.trigger("beforePannelShow"),T[t]&&T[t].show()},hidePannel:function(t){T[t]&&T[t].hide(),this.trigger("afterPannelHide")},bindEvents:function(){$(document).on("click.webide","[data-action]",function(){if($(this).data("sleep"))return!1;var t=$(this).data("action");t&&O[t]&&O[t].call(this)}).on("click",".js-media",function(t){var e=($(".js-chapters"),$(this).data("id"));if(!$(this).is(".cur"))return $.hash("mid",e),t.preventDefault(),!1}).on("click",".post-action",function(){var t=$(this).data("action"),e=$(this).data("mid");return G[t]&&G[t].call(this,e),!1}).on("click",".js-post-update",function(){var t=$(this).data("nid");t&&G.update.call(this,t)}).on("click",".js-view-again",function(){N.review()}),moco.imagePreview.init(".answerImg")}},R=function(t){for(var e,i,a,o,s,r='<div class="ide-guide-modal-wrap ide-guide-animate"><div class="ide-guide-modal"><div class="inner ide-guide-animate"><div class="top"></div><div class="bottom"><div class="dots"></div><a href="javascript:;" class="modal-btn">继续</a><span class="close-tip">不用了，谢谢</span></div></div></div></div>',d='<div class="guide-slider"><img src="{src}" alt=""></div>',c='<div class="ide-guide-modal-block"></div>',l="",u="",h=0,f=4,p="/static/module/common/img/ideguide/",m=0;4>m;m++)l+="<span></span>",u+=d.replace("{src}",p+(m+1)+".gif");var g=function(){i=$(r),i.find(".top").html(u),s=i.find(".guide-slider"),e=i.find(".dots"),o=$(c),e.html(l),o.appendTo("body").offset(),o.addClass("showed"),i.appendTo("body"),a=i.find(".ide-guide-modal"),a.offset(),a.addClass("showed"),e.on("click","span",function(){var t=$(this).index();h=t,v()}),i.on("click",".modal-btn",function(){v()}).on("click",".close-tip",function(){b()}),t.start(),v()},v=function(){return h++,h>f?void b():(h==f?i.find(".modal-btn").text("开始学习").end().find(".close-tip").hide():i.find(".modal-btn").text("继续").end().find(".close-tip").show(),void w(h))},w=function(t){s.hide().eq(t-1).show(),e.find("span").removeClass("on").eq(t-1).addClass("on")},y=function(){i.remove(),o.remove()},b=function(){y(),t.end(),n.set("webide_guided",!0)};return{init:g}}({start:function(){},end:function(){1==q.mode&&q.inst.playVideo(),k.set("guide",!1)}});juicer.register("spaceUrl",function(t,e){var i=OP_CONFIG.spaceUrl[e];return i+=t}),juicer.register("plus",function(t){return parseInt(t)+1});var H=function(){d=OP_CONFIG.curCourse||{},E.properties(),E.init(),$("textarea").on("keydown",function(t){t.stopPropagation()}),$("#webide-right").on("click",".js-ide-mini",function(){window.ideRightStatus=$("#webide-right").width()>40}),window.App=E};H()});